## Schema & Realtime Checklist (2025-08-20)

This document records the final state after hardening the database for Realtime + multi-tenancy.

### What we ensured
- REPLICA IDENTITY FULL on `public.agent_messages`, `public.bus_events`
- Publication membership: both tables in `supabase_realtime`
- RLS enabled on both tables
- Policies present:
  - `service_role_all` (PERMISSIVE FOR ALL USING true WITH CHECK true)
  - existing service_role and authenticated policies retained
- Indexes: `project_id` on both tables
- Views: `cogo.agent_messages`, `cogo.bus_events`
- Sequences: public overly-open ACL revoked; `service_role` maintained
- Default privileges: sequences default privs restricted to `service_role`

### Artifacts
- Schema snapshot directory: see latest under `schema/backups/`
- Generated by: `node scripts/db/schema_backup_snapshot.js`

### Runtime status
- Minimal server running at `http://localhost:3003`
- MCP Gateway and BusEventsBroadcaster running (mock MCP enabled)
- WS smoke test passed (mock): requires `MCP_FIGMA_WS_URL` for real MCP

### Next steps
- Set `MCP_FIGMA_WS_URL` and `MCP_REQUIRE_REAL=true` to test real MCP
- Optional: tighten additional RLS per project if needed


